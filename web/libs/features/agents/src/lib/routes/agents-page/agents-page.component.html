<ng-container
    *ngIf="({
        agent: agent$ | async,
        agentModules: agentModules$ | async,
        allGroups: allGroups$ | async,
        canBlockSelectedAgents: canBlockSelectedAgents$ | async,
        canUpgradeSelectedAgents: canUpgradeSelectedAgents$ | async,
        deleteError: deleteError$ | async,
        gridFiltrationByField: gridFiltrationByField$ | async,
        isBlockingAgents: isBlockingAgents$ | async,
        isCancelUpgradingAgent: isCancelUpgradingAgent$ | async,
        isDeletingAgent: isDeletingAgent$ | async,
        isDeletingFromGroup: isDeletingFromGroup$ | async,
        isLoadingAgent: isLoadingAgent$ | async,
        isLoadingAllGroups: isLoadingAllGroups$ | async,
        isMovingAgents: isMovingAgents$ | async,
        isUpdatingAgent: isUpdatingAgent$ | async,
        isUpgradingAgents: isUpgradingAgents$ | async,
        language: language$ | async,
        latestAgentBinaryVersion: latestAgentBinaryVersion$ | async,
        moveToGroupError: moveToGroupError$ | async,
        page: page$ | async,
        selected: selected$ | async,
        selectedGroupsTags: selectedGroupsTags$ | async,
        updateError: updateError$ | async
    }) as data">
    <div
        class="page-layout layout-column layout-align-space-between"
        *transloco="let t; read 'agents'">
        <ng-container *transloco="let tCommon; read 'common'">
            <soldr-actionbar class="flex-none">
                <ng-container actionbar-header>{{ t('Agents.AgentsList.ActionBarTitle.Agents') }}</ng-container>

                <ng-container actionbar-left>

                    <soldr-move-to-group
                        *ngIf="permitted.EditAgents"
                        [agents]="data.selected"
                        [allGroups]="data.allGroups"
                        [isLoading]="data.isLoadingAllGroups"
                        [isDeletingFromGroup]="data.isDeletingFromGroup"
                        [isMovingAgents]="data.isMovingAgents"
                        [moveToGroupError]="data.moveToGroupError"
                        (afterMove)="refreshData()"
                        (moveToGroups)="moveToGroups($event)"
                        (moveToNewGroups)="moveToNewGroups($event)"
                        (afterOpen)="refreshGroups()">
                        <button
                            mc-button
                            class="mc-button mc-icon-button mc-button_transparent actionbar__button"
                            e2e-id="btnMoveAgentsToGroup"
                            [class.mc-progress]="(isMovingAgents$ | async) === true"
                            [disabled]="!data.selected.length">
                            <i mc-icon="soldr-icons-folder-move_16" class="soldr-icons"></i>
                            <span>{{ t('Agents.AgentsList.ActionBarButtonText.MoveToGroup') }}</span>
                        </button>
                    </soldr-move-to-group>

                    <button
                        *ngIf="permitted.EditAgents"
                        mc-button
                        class="actionbar__button mc-button mc-button_transparent"
                        e2e-id="btnUpgradeAgents"
                        [disabled]="!data.canUpgradeSelectedAgents || data.isUpgradingAgents"
                        [class.mc-progress]="data.isUpgradingAgents"
                        (click)="upgradeAgents(data.selected, data.latestAgentBinaryVersion)">
                        <i mc-icon="soldr-icons-upload-to-cloud_16" class="soldr-icons"></i>
                        <span>{{ t('Agents.AgentsList.ActionBarButtonText.Upgrade') }}</span>
                    </button>

                    <soldr-edit-agent-modal
                        *ngIf="permitted.EditAgents"
                        [agent]="data.selected[0]"
                        [isUpdatingAgent]="data.isUpdatingAgent"
                        [updateError]="data.updateError"
                        (afterSave)="refreshData()"
                        (updateAgent)="update($event)">
                        <button
                            mc-button
                            class="actionbar__button mc-button mc-button_transparent"
                            e2e-id="btnEditAgents"
                            [disabled]="data.selected.length !== 1">
                            <i mc-icon="soldr-icons-edit_16" class="soldr-icons"></i>
                            <span>{{ tCommon('Common.Pseudo.ButtonText.Edit') }}</span>
                        </button>
                    </soldr-edit-agent-modal>

                    <button
                        *ngIf="permitted.EditAgents"
                        mc-button
                        class="actionbar__button mc-button mc-button_transparent"
                        e2e-id="btnBlockAgents"
                        [class.mc-progress]="data.isBlockingAgents"
                        [disabled]="!data.canBlockSelectedAgents"
                        (click)="blockAgents(data.selected)">
                        <i mc-icon="soldr-icons-lock-locked_16" class="soldr-icons"></i>
                        <span>{{ t('Agents.AgentsList.ActionBarButtonText.Block') }}</span>
                    </button>

                    <soldr-delete-agents-modal
                        *ngIf="permitted.DeleteAgents"
                        [agents]="data.selected"
                        [isDeletingAgent]="data.isDeletingAgent"
                        [deleteError]="data.deleteError"
                        (afterDelete)="refreshData()"
                        (deleteAgents)="delete($event)">
                        <button
                            mc-button
                            class="actionbar__button mc-button mc-button_transparent"
                            e2e-id="btnDeleteAgents"
                            [disabled]="!data.selected.length">
                            <i mc-icon="soldr-icons-delete_16" class="soldr-icons"></i>
                            <span>{{ tCommon('Common.Pseudo.ButtonText.Delete') }}</span>
                        </button>
                    </soldr-delete-agents-modal>
                </ng-container>
            </soldr-actionbar>

            <mc-splitter
                class="flex-auto layout-row"
                [direction]="direction.Horizontal"
                [hideGutters]="!pageState.leftSidebar.opened"
                *transloco="let tShared; read 'shared'">

                <mc-sidebar
                    #leftSidebar="mcSidebar"
                    class="sidebar_left"
                    mc-splitter-area
                    soldrSaveState
                    [position]="sidebarPositions.Left"
                    [opened]="pageState.leftSidebar.opened"
                    [saveStateKey]="'agents.list.leftSidebar'"
                    [saveStateValue]="pageState.leftSidebar"
                    (stateChanged)="saveLeftSidebarState($event)"
                    (soldrWidthChange)="saveLeftSidebarWidth($event)">

                    <div
                        mc-sidebar-opened
                        class="sidebar_opened page-layout__panel layout-column"
                        [width]="pageState.leftSidebar.width"
                        [minWidth]="'265px'"
                        [maxWidth]="'400px'">
                        <header class="sidebar-header flex-none">
                            <button
                                mc-button
                                class="mc-button_transparent sidebar-toggle"
                                e2e-id="btnCollapseAgentsSidebar"
                                [mcTooltip]="tShared('Shared.Pseudo.TooltipText.CollapseSidebar')"
                                (click)="leftSidebar.toggle()">
                                <i mc-icon="soldr-icons-double-angle-left_16" class="soldr-icons"></i>
                            </button>

                            <div class="sidebar-title layout-right-padding_16">
                                {{ tShared('Shared.FiltersAndGroups.SidebarTitle.FiltersAndGroups') }}
                            </div>

                            <soldr-tree-popover
                                [items]="groupsTags$ | async"
                                [selected]="selectedGroupsTags$ | async"
                                (search)="onSearchGroupsTags($event)"
                                (apply)="onSelectGroupsTags($event)">
                                <button
                                    mc-button
                                    class="mc-button_transparent"
                                    e2e-id="btnFilterByGroupsTags"
                                    [mcTooltip]="tShared('Shared.Pseudo.TooltipText.GroupsTags')">
                                    <i mc-icon="soldr-icons-tags_16" class="soldr-icons"></i>
                                    <span
                                        *ngIf="data.selectedGroupsTags?.length > 0"
                                        class="mc-extra-small-text agents-page__tags-counter">
                                        {{data.selectedGroupsTags?.length < 99 ? data.selectedGroupsTags?.length : '99+'}}
                                    </span>

                                </button>
                            </soldr-tree-popover>
                        </header>

                        <mc-divider class="flex-none"></mc-divider>

                        <soldr-groups-and-filters
                            class="flex-auto"
                            [viewMode]="viewMode.Agents"
                            [filters]="filters$ | async"
                            [filterId]="selectedFilterId$ | async"
                            (selectFilter)="onSelectFilter($event)"
                            (selectFilterByGroup)="onSelectGroup($event)">
                        </soldr-groups-and-filters>

                        <div></div>
                    </div>

                    <div
                        mc-sidebar-closed
                        class="sidebar-closed layout-column layout-align-start-center"
                        (click)="leftSidebar.toggle()">

                        <header class="sidebar-header">
                            <button
                                mc-button
                                class="mc-button_transparent sidebar-toggle"
                                e2e-id="btnExpandAgentsSidebar"
                                [mcTooltip]="tShared('Shared.Pseudo.TooltipText.ExpandSidebar')">
                                <i mc-icon="soldr-icons-double-angle-right_16" class="soldr-icons"></i>
                            </button>
                        </header>

                        <section class="flex">
                            <a class="sidebar-title">{{ tShared('Shared.FiltersAndGroups.SidebarTitle.FiltersAndGroups') }}</a>
                        </section>
                    </div>
                </mc-sidebar>

                <div mc-splitter-area class="flex layout-row">
                    <mc-splitter
                        class="flex layout-row"
                        [direction]="direction.Horizontal"
                        [hideGutters]="!pageState.rightSidebar.opened">

                        <div mc-splitter-area class="flex page-layout__panel">
                            <soldr-grid
                                #grid
                                class="layout-fill"
                                e2e-id="grAgents"
                                [data]="(dataGrid$ | async) || []"
                                [emptyText]="emptyText$ | async"
                                [exportSelectedTemplate]="exportSelected"
                                [exportAllTemplate]="exportAll"
                                [filtration]="gridFiltration$ | async"
                                [footerTemplate]="gridFooter"
                                [isLoading]="isLoadingAgents$ | async"
                                [placeholder]="t('Agents.AgentsList.InputPlaceholder.FieldsForSearch')"
                                [searchString]="search$ | async"
                                [selectionType]="selection.Multiple"
                                [selected]="data.selected"
                                [sorting]="sorting$ | async"
                                [storageKey]="'agents-list'"
                                [total]="total$ | async"
                                (export)="onExport($event)"
                                (search)="onGridSearch($event)"
                                (sortChanged)="onGridSort($event)"
                                (selectRows)="onGridSelectRows($event)"
                                (refresh)="refreshData()"
                                (resetFiltration)="onResetFiltration()"
                                (nextPage)="refreshData(data.page + 1)">

                                <ng-template #descriptionCell let-node="params.data">
                                    <soldr-text-overflow>
                                        <a mc-link e2e-id="lnkAgentCard" [routerLink]="['/agents', node.hash]">
                                            {{ node.description }}
                                        </a>
                                    </soldr-text-overflow>
                                </ng-template>

                                <ng-template #connectionStatusCell let-node="params.data">
                                    <soldr-agent-connection-status [status]="node.status"></soldr-agent-connection-status>
                                </ng-template>

                                <ng-template #authStatusCell let-node="params.data">
                                    <soldr-agent-auth-status [status]="node.auth_status"></soldr-agent-auth-status>
                                </ng-template>

                                <ng-template #osCell let-node="params.data">
                                    <soldr-os [os]="node.info?.os" [isOnlyAvailable]="true"></soldr-os>
                                </ng-template>

                                <ng-template #groupCell let-node="params.data">
                                    <soldr-group-link [group]="node.details?.group"></soldr-group-link>
                                </ng-template>

                                <ng-template #tagsCell let-node="params.data">
                                    <soldr-related-list
                                        [base]="node"
                                        [list]="node.info?.tags | sort:sortTags:data.language"
                                        [itemTemplate]="tagItem"
                                        [popoverItemTemplate]="tagPopoverItem">
                                    </soldr-related-list>
                                </ng-template>

                                <ng-template #tagItem let-tag="item">
                                    <a
                                        mc-link
                                        e2e-id="lnkFilterAgentsByTag"
                                        [mcTooltip]="tag"
                                        [mcPlacement]="placement.TopLeft"
                                        (click)="setTag(tag)">
                                        {{ tag }}
                                    </a>
                                </ng-template>

                                <ng-template #tagPopoverItem let-tag="item">
                                    <a mc-link e2e-id="lnkFilterAgentsByTag" (click)="setTag(tag)">
                                        {{ tag }}
                                    </a>
                                </ng-template>

                                <ng-template #versionCell let-node="params.data">
                                    <soldr-agent-version
                                        [agent]="node"
                                        [latestVersion]="latestAgentBinaryVersion$ | async">
                                    </soldr-agent-version>
                                </ng-template>

                                <ng-template #modulesCell let-node="params.data">
                                    <soldr-related-list
                                        [base]="node"
                                        [list]="node.details?.modules | sort:sortModules:data.language"
                                        [itemTemplate]="moduleItem"
                                        [popoverItemTemplate]="modulePopoverItem">
                                    </soldr-related-list>
                                </ng-template>

                                <ng-template #moduleItem let-module="item" let-agent="base">
                                    <a
                                        *ngIf="permitted.ViewPolicies; else linkText"
                                        mc-link
                                        e2e-id="lnkAgentModule"
                                        [routerLink]="['/agents', agent.hash, 'modules', module.info.name]"
                                        [mcTooltip]="module.locale.module[data.language].title"
                                        [mcPlacement]="placement.TopLeft">
                                        <ng-container [ngTemplateOutlet]="linkText"></ng-container>
                                    </a>
                                    <ng-template #linkText>
                                        {{ module.locale.module[data.language].title }}
                                    </ng-template>
                                </ng-template>

                                <ng-template #modulePopoverItem let-module="item" let-agent="base" let-last="last">
                                    <a
                                        *ngIf="permitted.ViewPolicies; else linkText"
                                        mc-link
                                        e2e-id="lnkAgentModule"
                                        [routerLink]="['/agents', agent.hash, 'modules', module.info.name]">
                                        <ng-container [ngTemplateOutlet]="linkText"></ng-container>
                                    </a>
                                    <ng-template #linkText>
                                        {{ module.locale.module[data.language].title }}
                                    </ng-template>
                                </ng-template>

                                <soldr-column
                                    field="description"
                                    [template]="descriptionCell"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.Name')"
                                    [default]="true"
                                    [required]="true"
                                    [resizable]="true"
                                    [sortable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="ip"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.Ip')"
                                    [width]="100"
                                    [default]="true"
                                    [resizable]="true"
                                    [sortable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="status"
                                    [template]="connectionStatusCell"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.Connection')"
                                    [width]="32"
                                    [minWidth]="32"
                                    [default]="true"
                                    [resizable]="true"
                                    [sortable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="os"
                                    [template]="osCell"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.Os')"
                                    [width]="32"
                                    [minWidth]="32"
                                    [default]="true"
                                    [resizable]="true"
                                    [sortable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="auth_status"
                                    [template]="authStatusCell"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.Authorization')"
                                    [width]="32"
                                    [minWidth]="32"
                                    [default]="true"
                                    [resizable]="true"
                                    [sortable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="details.upgrade_task"
                                    sortField="version"
                                    filtrationField="version"
                                    [template]="versionCell"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.Version')"
                                    [width]="60"
                                    [minWidth]="32"
                                    [default]="true"
                                    [resizable]="true"
                                    [sortable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="details.modules"
                                    filtrationField="module_name"
                                    [template]="modulesCell"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.Modules')"
                                    [minWidth]="100"
                                    [width]="240"
                                    [default]="false"
                                    [resizable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="details.group"
                                    filtrationField="group_id"
                                    [template]="groupCell"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.Group')"
                                    [width]="200"
                                    [default]="false"
                                    [resizable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="info.tags"
                                    filtrationField="tags"
                                    [template]="tagsCell"
                                    [headerName]="tShared('Shared.Pseudo.GridColumnsTitle.Tags')"
                                    [minWidth]="100"
                                    [width]="240"
                                    [default]="false"
                                    [resizable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="connected_date"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.LastConnection')"
                                    [default]="false"
                                    [resizable]="true"
                                    [sortable]="true">
                                </soldr-column>

                                <soldr-column
                                    field="hash"
                                    [headerName]="t('Agents.AgentsList.GridColumnsTitle.Id')"
                                    [default]="false"
                                    [resizable]="true">
                                </soldr-column>

                                <soldr-filter
                                    e2e-id="grFilterConnection"
                                    [field]="'status'"
                                    [title]="t('Agents.AgentsList.GridColumnsTitle.Connection')"
                                    [selectedValues]="data.gridFiltrationByField.status?.value"
                                    (changeValue)="onGridFilter($event)">
                                    <soldr-filter-item
                                        *ngFor="let item of gridColumnsFilters.status"
                                        [label]="item.label"
                                        [value]="item.value">
                                    </soldr-filter-item>
                                </soldr-filter>

                                <soldr-filter
                                    e2e-id="grFilterOs"
                                    [field]="'os'"
                                    [title]="t('Agents.AgentsList.GridColumnsTitle.Os')"
                                    [placeholder]="t('Agents.AgentsList.InputPlaceholder.FilterByOs')"
                                    [multiple]="true"
                                    [selectedValues]="data.gridFiltrationByField.os?.value"
                                    (changeValue)="onGridFilter($event)">
                                    <soldr-filter-item
                                        *ngFor="let item of gridColumnsFilters?.os"
                                        [label]="item.label"
                                        [value]="item.value">
                                    </soldr-filter-item>
                                </soldr-filter>

                                <soldr-filter
                                    e2e-id="grFilterAuthorization"
                                    [field]="'auth_status'"
                                    [title]="t('Agents.AgentsList.GridColumnsTitle.Authorization')"
                                    [selectedValues]="data.gridFiltrationByField.auth_status?.value"
                                    (changeValue)="onGridFilter($event)">
                                    <soldr-filter-item
                                        *ngFor="let item of gridColumnsFilters?.auth_status"
                                        [label]="item.label"
                                        [value]="item.value">
                                    </soldr-filter-item>
                                </soldr-filter>

                                <soldr-filter
                                    e2e-id="grFilterVersion"
                                    [field]="'version'"
                                    [title]="t('Agents.AgentsList.GridColumnsTitle.Version')"
                                    [placeholder]="t('Agents.AgentsList.InputPlaceholder.FilterByVersion')"
                                    [selectedValues]="data.gridFiltrationByField.version?.value"
                                    [multiple]="true"
                                    (changeValue)="onGridFilter($event)">
                                    <soldr-filter-item
                                        *ngFor="let item of gridColumnsFilters?.versions"
                                        [label]="item.label"
                                        [value]="item.value">
                                    </soldr-filter-item>
                                </soldr-filter>

                                <soldr-filter
                                    e2e-id="grFilterModules"
                                    [field]="'module_name'"
                                    [title]="t('Agents.AgentsList.GridColumnsTitle.Modules')"
                                    [placeholder]="t('Agents.AgentsList.InputPlaceholder.FilterByModule')"
                                    [multiple]="true"
                                    [selectedValues]="data.gridFiltrationByField.module_name?.value"
                                    (changeValue)="onGridFilter($event)">
                                    <soldr-filter-item
                                        *ngFor="let item of gridColumnsFilters?.modules"
                                        [label]="item.label"
                                        [value]="item.value">
                                    </soldr-filter-item>
                                </soldr-filter>

                                <soldr-filter
                                    e2e-id="grFilterGroupId"
                                    [field]="'group_id'"
                                    [title]="t('Agents.AgentsList.GridColumnsTitle.Group')"
                                    [placeholder]="t('Agents.AgentsList.InputPlaceholder.FilterByGroup')"
                                    [selectedValues]="data.gridFiltrationByField.group_id?.value"
                                    [multiple]="true"
                                    (changeValue)="onGridFilter($event)">
                                    <soldr-filter-item
                                        *ngFor="let item of gridColumnsFilters?.groups"
                                        [label]="item.label"
                                        [value]="item.value">
                                    </soldr-filter-item>
                                </soldr-filter>

                                <soldr-filter
                                    e2e-id="grFilterTags"
                                    [field]="'tags'"
                                    [title]="tShared('Shared.Pseudo.GridColumnsTitle.Tags')"
                                    [placeholder]="t('Agents.AgentsList.InputPlaceholder.FilterByTag')"
                                    [selectedValues]="data.gridFiltrationByField.tags?.value"
                                    [multiple]="true"
                                    (changeValue)="onGridFilter($event)">
                                    <soldr-filter-item
                                        *ngFor="let item of gridColumnsFilters?.tags"
                                        [label]="item.label"
                                        [value]="item.value">
                                    </soldr-filter-item>
                                </soldr-filter>

                            </soldr-grid>
                            <ng-template #gridFooter let-total="total" let-selected="selected">
                                <span>{{ t('Agents.AgentsList.Text.Total', { total }) }}</span>
                                <span>{{ t('Agents.AgentsList.Text.Selected', { selected }) }}</span>
                            </ng-template>

                            <ng-template #exportSelected let-selected="selected">
                                {{ t('Agents.ExportAgents.DropdownButtonText.ExportSelected', { selected }) }}
                            </ng-template>
                            <ng-template #exportAll let-total="total">
                                {{ t('Agents.ExportAgents.DropdownButtonText.ExportAll', { total }) }}
                            </ng-template>
                        </div>

                        <mc-sidebar
                            class="sidebar_right"
                            mc-splitter-area
                            soldrSaveState
                            #rightSidebar="mcSidebar"
                            [position]="sidebarPositions.Right"
                            [opened]="pageState.rightSidebar.opened"
                            [saveStateKey]="'agents.list.rightSidebar'"
                            [saveStateValue]="pageState.rightSidebar"
                            (stateChanged)="saveRightSidebarState($event)"
                            (soldrWidthChange)="saveRightSidebarWidth($event)">

                            <div
                                mc-sidebar-opened
                                class="sidebar_opened page-layout__panel layout-column"
                                [width]="pageState.rightSidebar.width"
                                [minWidth]="'265px'"
                                [maxWidth]="'400px'">
                                <header class="sidebar-header">
                                    <button
                                        mc-button
                                        class="mc-button_transparent sidebar-toggle"
                                        e2e-id="btnCollapseAgentsSidebar"
                                        [mcTooltip]="tShared('Shared.Pseudo.TooltipText.CollapseSidebar')"
                                        (click)="rightSidebar.toggle()">
                                        <span mc-icon="soldr-icons-double-angle-right_16" class="soldr-icons"></span>
                                    </button>

                                    <div class="sidebar-title layout-right-padding_16">
                                        <a
                                            *ngIf="data.selected.length === 1"
                                            mc-link
                                            e2e-id="lnkAgentCard"
                                            class="layout-row layout-align-space-between-center"
                                            [routerLink]="['/agents', data.selected[0]?.hash]"
                                            [noUnderline]="true">
                                            <span class="mc-link__text">{{ data.selected[0]?.description }}</span>
                                        </a>
                                        <ng-container *ngIf="data.selected.length > 1">
                                            {{ t('Agents.AgentsList.SidebarTitle.SelectedAgents', {
                                            count: data.selected.length
                                        }) }}
                                        </ng-container>
                                    </div>
                                </header>

                                <mc-divider></mc-divider>

                                <div
                                    class="sidebar-content flex-auto"
                                    soldrProgressSpinner
                                    [loadingFlag]="data.isLoadingAgent">
                                    <soldr-agent-info
                                        class="scrollable-y layout-fill"
                                        *ngIf="data.selected.length === 1"
                                        [agent]="data.selected[0]"
                                        [latestBinaryVersion]="data.latestAgentBinaryVersion"
                                        [modules]="data.agentModules"
                                        [state]="pageState.rightSidebar"
                                        [stateStorageKey]="'agents.list.rightSidebar'"
                                        [showModules]="true"
                                        [isUpgradingAgents]="data.isUpgradingAgents"
                                        [isCancelUpgradingAgent]="data.isCancelUpgradingAgent"
                                        (upgradeAgents)="upgrade($event)"
                                        (cancelUpgradeAgent)="cancelUpgrade($event)"
                                        (selectTag)="setTag($event)"
                                        (refresh)="afterUpgradeAgent(data.agent)">
                                    </soldr-agent-info>

                                    <soldr-multiple-selection-panel
                                        *ngIf="data.selected.length > 1 && (permitted.EditAgents || permitted.DeleteAgents)"
                                        [title]="t('Agents.AgentsList.Text.SelectedAgents', { selected: data.selected.length})">

                                        <soldr-move-to-group
                                            *ngIf="data.selected.length > 0 && permitted.EditAgents"
                                            [agents]="data.selected"
                                            [allGroups]="data.allGroups"
                                            [isLoading]="data.isLoadingAllGroups"
                                            [isDeletingFromGroup]="data.isDeletingFromGroup"
                                            [isMovingAgents]="data.isMovingAgents"
                                            [moveToGroupError]="data.moveToGroupError"
                                            (afterMove)="refreshData()"
                                            (moveToGroups)="moveToGroups($event)"
                                            (moveToNewGroups)="moveToNewGroups($event)"
                                            (afterOpen)="refreshGroups()">
                                            <button
                                                mc-button
                                                class="mc-button_transparent"
                                                e2e-id="btnMoveAgentsToGroup"
                                                [class.mc-progress]="(isMovingAgents$ | async) === true">
                                                <i mc-icon="soldr-icons-folder-closed_16" class="soldr-icons"></i>
                                                {{ t('Agents.AgentsList.ButtonText.MoveToGroup') }}
                                            </button>
                                        </soldr-move-to-group>
                                        <button
                                            *ngIf="data.canUpgradeSelectedAgents && permitted.EditAgents"
                                            mc-button
                                            class="mc-button_transparent"
                                            e2e-id="btnUpgradeAgents"
                                            [color]="themePalette.Second"
                                            (click)="upgradeAgents(data.selected, data.latestAgentBinaryVersion)">
                                            <i mc-icon="soldr-icons-upload-to-cloud_16" class="soldr-icons"></i>
                                            {{ t('Agents.AgentsList.ButtonText.InstallUpgrades') }}
                                        </button>
                                        <button
                                            *ngIf="data.canBlockSelectedAgents && permitted.EditAgents"
                                            mc-button
                                            class="mc-button_transparent"
                                            e2e-id="btnBlockAgents"
                                            [color]="themePalette.Second"
                                            [class.mc-progress]="(isBlockingAgents$ | async) === true"
                                            (click)="blockAgents(data.selected)">
                                            <i mc-icon="soldr-icons-lock-locked_16" class="soldr-icons"></i>
                                            {{ t('Agents.AgentsList.ButtonText.Block') }}
                                        </button>

                                        <mc-divider class="panel-divider"></mc-divider>

                                        <soldr-delete-agents-modal
                                            *ngIf="permitted.DeleteAgents"
                                            [agents]="data.selected"
                                            [isDeletingAgent]="data.isDeletingAgent"
                                            [deleteError]="data.deleteError"
                                            (afterDelete)="refreshData()"
                                            (deleteAgents)="delete($event)">
                                            <button
                                                mc-button
                                                class="mc-button_transparent"
                                                e2e-id="btnDeleteAgents"
                                                [color]="themePalette.Second">
                                                <i mc-icon="soldr-icons-delete_16" class="soldr-icons"></i>
                                                {{ tCommon('Common.Pseudo.ButtonText.Delete') }}
                                            </button>
                                        </soldr-delete-agents-modal>

                                    </soldr-multiple-selection-panel>

                                    <div *ngIf="data.selected.length === 0"
                                         class="layout-fill layout-column layout-align-center-center">
                                        <span class="text_second">
                                            {{ tCommon('Common.Pseudo.Text.NoInformation') }}
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div
                                mc-sidebar-closed
                                class="sidebar-closed layout-column layout-align-start-center"
                                (click)="rightSidebar.toggle()">
                                <header class="sidebar-header layout-row">
                                    <button
                                        mc-button
                                        class="mc-button_transparent sidebar-toggle"
                                        e2e-id="btnExpandAgentsSidebar"
                                        [mcTooltip]="tShared('Shared.Pseudo.TooltipText.ExpandSidebar')">
                                        <i mc-icon="soldr-icons-double-angle-left_16" class="soldr-icons"></i>
                                    </button>
                                </header>

                                <section class="flex">
                                    <div class="sidebar-title">
                                        <ng-container *ngIf="data.selected.length === 1">
                                            {{ data.selected[0]?.description }}
                                        </ng-container>
                                        <ng-container *ngIf="data.selected.length > 1">
                                            {{ t('Agents.AgentsList.SidebarTitle.SelectedAgents', {
                                            count: data.selected.length
                                        }) }}
                                        </ng-container>
                                    </div>
                                </section>
                            </div>
                        </mc-sidebar>
                    </mc-splitter>
                </div>

            </mc-splitter>
        </ng-container>
    </div>

</ng-container>
